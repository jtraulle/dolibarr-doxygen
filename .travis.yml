language: minimal

cache:
  directories:
  - $TRAVIS_BUILD_DIR/build_index
  - $TRAVIS_BUILD_DIR/build_develop
  - $TRAVIS_BUILD_DIR/build_versions00
  - $TRAVIS_BUILD_DIR/build_versions01

addons:
  apt:
    packages:
      - doxygen
      - graphviz

before_script:
  - git clone https://github.com/Dolibarr/dolibarr.git

matrix:
  fast_finish: true

jobs:
  include:
    - stage: "Prepare"
      name: "Generate unified index file"
      script: ./generateUnifiedIndex.sh
    - stage: "Build"
      name: "Build doxygen docs for Dolibarr develop (nigthly)"
      script: ./generateDoxygenForDevelop.sh
    - stage: "Build"
      name: "Build doxygen docs for Dolibarr versions (1/10)"
      env:
        - VERSIONSFILE=versions00
      script: ./generateDoxygenForVersions.sh
    - stage: "Build"
      name: "Build doxygen docs for Dolibarr versions (2/10)"
      env:
        - VERSIONSFILE=versions01
      script: ./generateDoxygenForVersions.sh
    - stage: deploy
      name: "Deploy generated Doxygen docs to GitHub pages"
      script:
        - tree
        - cp $TRAVIS_BUILD_DIR/build_index/* $TRAVIS_BUILD_DIR/build
        - cp $TRAVIS_BUILD_DIR/build_develop/* $TRAVIS_BUILD_DIR/build
        - cp $TRAVIS_BUILD_DIR/build_versions00/* $TRAVIS_BUILD_DIR/build
        - cp $TRAVIS_BUILD_DIR/build_versions01/* $TRAVIS_BUILD_DIR/build
        - cp $TRAVIS_BUILD_DIR/build_versions02/* $TRAVIS_BUILD_DIR/build
        - cp $TRAVIS_BUILD_DIR/build_versions03/* $TRAVIS_BUILD_DIR/build
        - cp $TRAVIS_BUILD_DIR/build_versions04/* $TRAVIS_BUILD_DIR/build
        - cp $TRAVIS_BUILD_DIR/build_versions05/* $TRAVIS_BUILD_DIR/build
        - cp $TRAVIS_BUILD_DIR/build_versions06/* $TRAVIS_BUILD_DIR/build
        - cp $TRAVIS_BUILD_DIR/build_versions07/* $TRAVIS_BUILD_DIR/build
        - cp $TRAVIS_BUILD_DIR/build_versions08/* $TRAVIS_BUILD_DIR/build
        - cp $TRAVIS_BUILD_DIR/build_versions09/* $TRAVIS_BUILD_DIR/build
        - tree
      deploy:
        provider: pages
        skip_cleanup: true
        local_dir: $TRAVIS_BUILD_DIR/build
        github_token: $GITHUB_API_KEY
        on:
          branch: master

